<%- include('../partials/layout-start') %>
<section class="page-header">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
    <div>
      <h1>Кабінет адміністратора</h1>
      <p class="text-muted mb-0">Керуйте заявками, фінансами, контентом та автопарком безпосередньо на сайті.</p>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-light" href="/">Перейти на сайт</a>
      <a class="btn btn-outline-primary" href="/admin/export/users.pdf"><i class="fa-regular fa-file-pdf me-2"></i>Експорт користувачів</a>
      <form method="POST" action="/admin/logout">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        <button class="btn btn-outline-danger" type="submit"><i class="fa-solid fa-right-from-bracket me-2"></i>Вийти</button>
      </form>
    </div>
  </div>
</section>

<section class="mt-4">
  <div class="row g-4">
    <div class="col-md-4">
      <div class="stat-card">
        <h3>Зібрано</h3>
        <p class="stat-number"><%= totals.totalRaised.toLocaleString('uk-UA') %> ₴</p>
      </div>
    </div>
    <div class="col-md-4">
      <div class="stat-card">
        <h3>Використано</h3>
        <p class="stat-number text-danger"><%= totals.totalWithdrawn.toLocaleString('uk-UA') %> ₴</p>
      </div>
    </div>
    <div class="col-md-4">
      <div class="stat-card">
        <h3>Баланс</h3>
        <p class="stat-number text-success"><%= totals.balance.toLocaleString('uk-UA') %> ₴</p>
      </div>
    </div>
  </div>
</section>

<nav class="admin-nav mt-4">
  <a href="#finance">Фінанси</a>
  <a href="#users">Користувачі</a>
  <a href="#vehicles">Автопарк</a>
  <a href="#content">Контент</a>
  <a href="#community">Спільнота</a>
</nav>

<section id="finance" class="mt-5">
  <div class="row g-4">
    <div class="col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h2 class="h4">Додати донат вручну</h2>
          <form method="POST" action="/admin/donations" class="mt-3" novalidate>
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <div class="mb-3">
              <label class="form-label" for="donor_name">Ім'я</label>
              <input class="form-control" type="text" id="donor_name" name="donor_name" required>
            </div>
            <div class="mb-3">
              <label class="form-label" for="amount">Сума</label>
              <input class="form-control" type="number" id="amount" name="amount" min="10" required>
            </div>
            <div class="mb-3">
              <label class="form-label" for="currency">Валюта</label>
              <input class="form-control" type="text" id="currency" name="currency" value="UAH">
            </div>
            <div class="mb-3">
              <label class="form-label" for="message">Коментар</label>
              <textarea class="form-control" id="message" name="message" rows="3"></textarea>
            </div>
            <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="public" name="public" checked>
              <label class="form-check-label" for="public">Показувати у публічному списку</label>
            </div>
            <button class="btn btn-primary" type="submit">Зберегти</button>
          </form>
        </div>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h2 class="h4">Зафіксувати витрати</h2>
          <form method="POST" action="/admin/withdrawals" class="mt-3" novalidate>
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <div class="mb-3">
              <label class="form-label" for="withdraw_amount">Сума</label>
              <input class="form-control" type="number" id="withdraw_amount" name="amount" min="1" required>
            </div>
            <div class="mb-3">
              <label class="form-label" for="description">Призначення</label>
              <textarea class="form-control" id="description" name="description" rows="3"></textarea>
            </div>
            <button class="btn btn-outline-primary" type="submit">Додати витрату</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4 mt-4">
    <div class="col-lg-7">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h2 class="h5">Поточні реквізити</h2>
          <% bankAccounts.forEach(function(account) { %>
            <form method="POST" action="/admin/bank-accounts/<%= account.id %>" class="border rounded p-3 mb-3" novalidate>
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <div class="row g-2">
                <div class="col-md-6">
                  <label class="form-label">Назва</label>
                  <input class="form-control" type="text" name="label" value="<%= account.label %>" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Отримувач</label>
                  <input class="form-control" type="text" name="recipient" value="<%= account.recipient %>" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label">IBAN</label>
                  <input class="form-control" type="text" name="iban" value="<%= account.iban %>" required>
                </div>
                <div class="col-md-3">
                  <label class="form-label">ЄДРПОУ</label>
                  <input class="form-control" type="text" name="edrpou" value="<%= account.edrpou || '' %>">
                </div>
                <div class="col-12">
                  <label class="form-label">Призначення</label>
                  <textarea class="form-control" name="purpose" rows="2"><%= account.purpose || '' %></textarea>
                </div>
              </div>
              <div class="d-flex justify-content-between align-items-center mt-3">
                <small class="text-muted">Оновлено <%= new Date(account.updated_at).toLocaleDateString('uk-UA') %></small>
                <button class="btn btn-sm btn-outline-primary" type="submit">Зберегти</button>
              </div>
            </form>
            <form method="POST" action="/admin/bank-accounts/<%= account.id %>/delete" class="mb-4" onsubmit="return confirm('Видалити реквізити?');">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <button class="btn btn-sm btn-outline-danger" type="submit">Видалити рахунок</button>
            </form>
          <% }) %>
          <form method="POST" action="/admin/bank-accounts" class="border rounded p-3" novalidate>
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <h3 class="h6">Додати новий рахунок</h3>
            <div class="row g-2">
              <div class="col-md-6">
                <label class="form-label">Назва</label>
                <input class="form-control" type="text" name="label" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Отримувач</label>
                <input class="form-control" type="text" name="recipient" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">IBAN</label>
                <input class="form-control" type="text" name="iban" required>
              </div>
              <div class="col-md-3">
                <label class="form-label">ЄДРПОУ</label>
                <input class="form-control" type="text" name="edrpou">
              </div>
              <div class="col-12">
                <label class="form-label">Призначення</label>
                <textarea class="form-control" name="purpose" rows="2"></textarea>
              </div>
            </div>
            <button class="btn btn-sm btn-outline-primary mt-3" type="submit">Додати</button>
          </form>
        </div>
      </div>
    </div>
    <div class="col-lg-5">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h2 class="h5">Цілі зборів</h2>
          <% goals.forEach(function(goal) { %>
            <form method="POST" action="/admin/goals/<%= goal.id %>" class="border rounded p-3 mb-3" novalidate>
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <div class="mb-2">
                <label class="form-label">Назва</label>
                <input class="form-control" type="text" name="title" value="<%= goal.title %>" required>
              </div>
              <div class="mb-2">
                <label class="form-label">Опис</label>
                <textarea class="form-control" name="description" rows="2"><%= goal.description || '' %></textarea>
              </div>
              <div class="mb-2">
                <label class="form-label">Сума, ₴</label>
                <input class="form-control" type="number" name="target_amount" value="<%= goal.target_amount %>" min="1000" required>
              </div>
              <div class="mb-2">
                <label class="form-label">Статус</label>
                <select class="form-select" name="status">
                  <option value="draft" <%= goal.status === 'draft' ? 'selected' : '' %>>Чернетка</option>
                  <option value="active" <%= goal.status === 'active' ? 'selected' : '' %>>Активна</option>
                  <option value="archived" <%= goal.status === 'archived' ? 'selected' : '' %>>Архівована</option>
                </select>
              </div>
              <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted">Оновлено <%= new Date(goal.updated_at).toLocaleDateString('uk-UA') %></small>
                <button class="btn btn-sm btn-outline-primary" type="submit">Оновити</button>
              </div>
            </form>
          <% }) %>
          <form method="POST" action="/admin/goals" class="border rounded p-3" novalidate>
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <h3 class="h6">Нова ціль</h3>
            <div class="mb-2">
              <label class="form-label">Назва</label>
              <input class="form-control" type="text" name="title" required>
            </div>
            <div class="mb-2">
              <label class="form-label">Опис</label>
              <textarea class="form-control" name="description" rows="2"></textarea>
            </div>
            <div class="mb-2">
              <label class="form-label">Сума, ₴</label>
              <input class="form-control" type="number" name="target_amount" min="1000" required>
            </div>
            <div class="mb-2">
              <label class="form-label">Статус</label>
              <select class="form-select" name="status">
                <option value="draft">Чернетка</option>
                <option value="active">Активна</option>
                <option value="archived">Архівована</option>
              </select>
            </div>
            <button class="btn btn-sm btn-outline-primary" type="submit">Створити</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="card shadow-sm mt-4">
    <div class="card-body">
      <h2 class="h5">Свіжі донати</h2>
      <div class="table-responsive">
        <table class="table table-sm align-middle">
          <thead>
            <tr>
              <th>Ім'я</th>
              <th>Сума</th>
              <th>Дата</th>
            </tr>
          </thead>
          <tbody>
            <% donations.forEach(function(donation) { %>
              <tr>
                <td><%= donation.donor_name %></td>
                <td><%= donation.amount.toLocaleString('uk-UA') %> <%= donation.currency %></td>
                <td><%= new Date(donation.created_at).toLocaleString('uk-UA') %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<section id="users" class="mt-5">
  <h2 class="h3 mb-3">Користувачі та доступи</h2>
  <div class="row g-4">
    <div class="col-xl-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h3 class="h5">Заявки на розгляд</h3>
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>ПІБ</th>
                  <th>Email</th>
                  <th>Телефон</th>
                  <th>Статус</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <% applicants.forEach(function(applicant) { %>
                  <tr>
                    <td><%= applicant.full_name || '—' %></td>
                    <td><%= applicant.email %></td>
                    <td><%= applicant.phone || '—' %></td>
                    <td><span class="badge bg-light text-dark"><%= applicant.status %></span></td>
                    <td class="text-end">
                      <% if (applicant.proof_path) { %>
                        <a class="btn btn-sm btn-outline-secondary" href="/<%= applicant.proof_path %>" target="_blank">Чек</a>
                      <% } %>
                      <form method="POST" action="/admin/users/<%= applicant.id %>/approve" class="d-inline">
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                        <input type="hidden" name="role" value="donor">
                        <button class="btn btn-sm btn-success" type="submit">Прийняти</button>
                      </form>
                      <form method="POST" action="/admin/users/<%= applicant.id %>/reject" class="d-inline">
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                        <button class="btn btn-sm btn-outline-secondary" type="submit">Відхилити</button>
                      </form>
                      <form method="POST" action="/admin/users/<%= applicant.id %>/ban" class="d-inline" onsubmit="return confirm('Заблокувати користувача?');">
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                        <button class="btn btn-sm btn-outline-danger" type="submit">Бан</button>
                      </form>
                    </td>
                  </tr>
                <% }) %>
                <% if (applicants.length === 0) { %>
                  <tr><td colspan="5" class="text-center text-muted">Немає заявок у черзі.</td></tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-6">
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h3 class="h5">Підтверджені донатери</h3>
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>ПІБ</th>
                  <th>Email</th>
                  <th>Телефон</th>
                  <th>Роль</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <% donors.forEach(function(donor) { %>
                  <tr>
                    <td><%= donor.full_name || '—' %></td>
                    <td><%= donor.email %></td>
                    <td><%= donor.phone || '—' %></td>
                    <td><%= 'donor' %></td>
                    <td class="text-end">
                      <form method="POST" action="/admin/users/<%= donor.id %>/role" class="d-inline">
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                        <select class="form-select form-select-sm d-inline-block w-auto" name="role" onchange="this.form.submit()">
                          <option value="donor" selected>Donor</option>
                          <option value="moderator">Moderator</option>
                          <option value="admin">Admin</option>
                        </select>
                      </form>
                    </td>
                  </tr>
                <% }) %>
                <% if (donors.length === 0) { %>
                  <tr><td colspan="5" class="text-center text-muted">Ще немає підтверджених донаторів.</td></tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="card shadow-sm">
        <div class="card-body">
          <h3 class="h5">Адміністратори</h3>
          <ul class="list-group list-group-flush">
            <% admins.forEach(function(admin) { %>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <strong><%= admin.full_name || admin.email %></strong>
                  <p class="mb-0 small text-muted"><%= admin.email %></p>
                </div>
                <span class="small text-muted">Вхід: <%= admin.last_login_at ? new Date(admin.last_login_at).toLocaleDateString('uk-UA') : '—' %></span>
              </li>
            <% }) %>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>

<section id="vehicles" class="mt-5">
  <h2 class="h3 mb-3">Автопарк</h2>
  <div class="row g-4">
    <div class="col-lg-7">
      <div class="card shadow-sm">
        <div class="card-body">
          <h3 class="h5">Поточні авто</h3>
          <% vehicles.forEach(function(vehicle) { %>
            <form method="POST" action="/admin/vehicles/<%= vehicle.id %>" class="border rounded p-3 mb-2" novalidate>
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <div class="mb-2">
                <label class="form-label">Назва</label>
                <input class="form-control" type="text" name="name" value="<%= vehicle.name %>" required>
              </div>
              <div class="mb-2">
                <label class="form-label">Опис</label>
                <textarea class="form-control" name="description" rows="2"><%= vehicle.description || '' %></textarea>
              </div>
              <div class="row g-2">
                <div class="col-md-4">
                  <label class="form-label">Статус</label>
                  <input class="form-control" type="text" name="status" value="<%= vehicle.status %>" required>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Категорія</label>
                  <input class="form-control" type="text" name="category" value="<%= vehicle.category || '' %>">
                </div>
                <div class="col-md-4">
                  <label class="form-label">Зображення</label>
                  <input class="form-control" type="text" name="image_path" value="<%= vehicle.image_path || '' %>">
                </div>
              </div>
              <button class="btn btn-sm btn-outline-primary mt-3" type="submit">Зберегти</button>
            </form>
            <form method="POST" action="/admin/vehicles/<%= vehicle.id %>/delete" class="mb-3" onsubmit="return confirm('Видалити авто?');">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <button class="btn btn-sm btn-outline-danger" type="submit">Видалити авто</button>
            </form>
          <% }) %>
          <% if (vehicles.length === 0) { %>
            <p class="text-muted mb-0">Список авто поки порожній.</p>
          <% } %>
        </div>
      </div>
    </div>
    <div class="col-lg-5">
      <div class="card shadow-sm">
        <div class="card-body">
          <h3 class="h5">Додати / оновити авто</h3>
          <form method="POST" action="/admin/vehicles" class="row g-3" novalidate>
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <div class="col-12">
              <label class="form-label" for="vehicle_name">Назва</label>
              <input class="form-control" type="text" id="vehicle_name" name="name" required>
            </div>
            <div class="col-12">
              <label class="form-label" for="vehicle_description">Опис</label>
              <textarea class="form-control" id="vehicle_description" name="description" rows="3"></textarea>
            </div>
            <div class="col-md-6">
              <label class="form-label" for="vehicle_status">Статус</label>
              <input class="form-control" type="text" id="vehicle_status" name="status" placeholder="needs_funding" required>
            </div>
            <div class="col-md-6">
              <label class="form-label" for="vehicle_category">Категорія</label>
              <input class="form-control" type="text" id="vehicle_category" name="category" placeholder="suv">
            </div>
            <div class="col-12">
              <label class="form-label" for="vehicle_image">Зображення (шлях)</label>
              <input class="form-control" type="text" id="vehicle_image" name="image_path" placeholder="images/img/cars/car1.jpg">
            </div>
            <div class="col-12">
              <button class="btn btn-outline-primary" type="submit">Зберегти</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<section id="content" class="mt-5">
  <h2 class="h3 mb-3">Контент та публікації</h2>
  <div class="row g-4">
    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h3 class="h5">Головні блоки</h3>
          <% contentBlocks.forEach(function(block) { %>
            <form method="POST" action="/admin/content-blocks/<%= block.slug %>" class="border rounded p-3 mb-3">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <h4 class="h6 text-uppercase text-muted"><%= block.slug %></h4>
              <div class="mb-2">
                <label class="form-label">Заголовок</label>
                <input class="form-control" type="text" name="title" value="<%= block.title || '' %>">
              </div>
              <div class="mb-2">
                <label class="form-label">Текст</label>
                <textarea class="form-control" name="body" rows="3"><%= block.body || '' %></textarea>
              </div>
              <button class="btn btn-sm btn-outline-primary" type="submit">Оновити</button>
            </form>
          <% }) %>
        </div>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h3 class="h5">Медіа про нас</h3>
          <% media.forEach(function(item) { %>
            <form method="POST" action="/admin/media/<%= item.id %>" class="border rounded p-3 mb-3" novalidate>
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <div class="mb-2">
                <label class="form-label">Назва</label>
                <input class="form-control" type="text" name="title" value="<%= item.title %>" required>
              </div>
              <div class="mb-2">
                <label class="form-label">Коротко</label>
                <textarea class="form-control" name="summary" rows="2"><%= item.summary || '' %></textarea>
              </div>
              <div class="mb-2">
                <label class="form-label">Посилання</label>
                <input class="form-control" type="url" name="url" value="<%= item.url %>" required>
              </div>
              <div class="mb-2">
                <label class="form-label">Зображення</label>
                <input class="form-control" type="text" name="image_path" value="<%= item.image_path || '' %>">
              </div>
              <button class="btn btn-sm btn-outline-primary" type="submit">Зберегти</button>
            </form>
            <form method="POST" action="/admin/media/<%= item.id %>/delete" class="mb-3" onsubmit="return confirm('Видалити матеріал?');">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <button class="btn btn-sm btn-outline-danger" type="submit">Видалити матеріал</button>
            </form>
          <% }) %>
          <form method="POST" action="/admin/media" class="border rounded p-3" novalidate>
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <h4 class="h6">Новий матеріал</h4>
            <div class="mb-2">
              <label class="form-label">Назва</label>
              <input class="form-control" type="text" name="title" required>
            </div>
            <div class="mb-2">
              <label class="form-label">Коротко</label>
              <textarea class="form-control" name="summary" rows="2"></textarea>
            </div>
            <div class="mb-2">
              <label class="form-label">Посилання</label>
              <input class="form-control" type="url" name="url" required>
            </div>
            <div class="mb-2">
              <label class="form-label">Зображення</label>
              <input class="form-control" type="text" name="image_path">
            </div>
            <button class="btn btn-sm btn-outline-primary" type="submit">Додати</button>
          </form>
        </div>
      </div>
      <div class="card shadow-sm">
        <div class="card-body">
          <h3 class="h5">Статті та новини</h3>
          <% articles.forEach(function(article) { %>
            <form method="POST" action="/admin/articles/<%= article.id %>" class="border rounded p-3 mb-3" novalidate>
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <div class="mb-2">
                <label class="form-label">Заголовок</label>
                <input class="form-control" type="text" name="title" value="<%= article.title %>" required>
              </div>
              <div class="mb-2">
                <label class="form-label">Анонс</label>
                <textarea class="form-control" name="excerpt" rows="2"><%= article.excerpt || '' %></textarea>
              </div>
              <div class="mb-2">
                <label class="form-label">Текст</label>
                <textarea class="form-control" name="body" rows="3"><%= article.body || '' %></textarea>
              </div>
              <div class="mb-2">
                <label class="form-label">Зображення</label>
                <input class="form-control" type="text" name="cover_image" value="<%= article.cover_image || '' %>">
              </div>
              <div class="mb-2">
                <label class="form-label">Дата публікації</label>
                <input class="form-control" type="date" name="published_at" value="<%= article.published_at ? article.published_at.substring(0,10) : '' %>">
              </div>
              <button class="btn btn-sm btn-outline-primary" type="submit">Оновити</button>
            </form>
            <form method="POST" action="/admin/articles/<%= article.id %>/delete" class="mb-3" onsubmit="return confirm('Видалити статтю?');">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <button class="btn btn-sm btn-outline-danger" type="submit">Видалити статтю</button>
            </form>
          <% }) %>
          <form method="POST" action="/admin/articles" class="border rounded p-3" novalidate>
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <h4 class="h6">Нова стаття</h4>
            <div class="mb-2">
              <label class="form-label">Заголовок</label>
              <input class="form-control" type="text" name="title" required>
            </div>
            <div class="mb-2">
              <label class="form-label">Анонс</label>
              <textarea class="form-control" name="excerpt" rows="2"></textarea>
            </div>
            <div class="mb-2">
              <label class="form-label">Текст</label>
              <textarea class="form-control" name="body" rows="3"></textarea>
            </div>
            <div class="mb-2">
              <label class="form-label">Зображення</label>
              <input class="form-control" type="text" name="cover_image">
            </div>
            <div class="mb-2">
              <label class="form-label">Дата публікації</label>
              <input class="form-control" type="date" name="published_at">
            </div>
            <button class="btn btn-sm btn-outline-primary" type="submit">Опублікувати</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<section id="community" class="mt-5">
  <h2 class="h3 mb-3">Спільнота та волонтери</h2>
  <div class="row g-4">
    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h3 class="h5">Відгуки донаторів</h3>
          <% reviews.forEach(function(review) { %>
            <form method="POST" action="/admin/reviews/<%= review.id %>/toggle" class="border rounded p-3 mb-3">
              <input type="hidden" name="_csrf" value="<%= csrfToken %>">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <strong><%= review.author_name %></strong>
                  <% if (review.rating) { %>
                    <span class="ms-2 text-warning">
                      <% for (let i = 0; i < review.rating; i++) { %>
                        <i class="fa-solid fa-star"></i>
                      <% } %>
                    </span>
                  <% } %>
                </div>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" name="public" value="on" <%= review.public ? 'checked' : '' %> onchange="this.form.submit()">
                </div>
              </div>
              <p class="mb-2">“<%= review.message %>”</p>
              <p class="small text-muted mb-0">Додано <%= new Date(review.created_at).toLocaleDateString('uk-UA') %></p>
            </form>
          <% }) %>
          <form method="POST" action="/admin/reviews" class="border rounded p-3" novalidate>
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <h4 class="h6">Новий відгук</h4>
            <div class="mb-2">
              <label class="form-label">Ім'я</label>
              <input class="form-control" type="text" name="author_name" required>
            </div>
            <div class="mb-2">
              <label class="form-label">Оцінка (1-5)</label>
              <input class="form-control" type="number" name="rating" min="1" max="5">
            </div>
            <div class="mb-2">
              <label class="form-label">Повідомлення</label>
              <textarea class="form-control" name="message" rows="3" required></textarea>
            </div>
            <div class="form-check mb-2">
              <input class="form-check-input" type="checkbox" id="review_public" name="public" checked>
              <label class="form-check-label" for="review_public">Показувати одразу</label>
            </div>
            <button class="btn btn-sm btn-outline-primary" type="submit">Зберегти</button>
          </form>
        </div>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <h3 class="h5">Запити волонтерів</h3>
          <div class="list-card">
            <% feedback.forEach(function(item) { %>
              <div class="list-card-item">
                <strong><%= item.sender_name %></strong>
                <p class="mb-1"><%= item.message %></p>
                <% if (item.contact) { %>
                  <p class="small text-muted"><i class="fa-solid fa-link me-1"></i><%= item.contact %></p>
                <% } %>
                <% if (item.channel) { %>
                  <span class="badge bg-light text-dark"><%= item.channel %></span>
                <% } %>
              </div>
            <% }) %>
            <% if (feedback.length === 0) { %>
              <div class="list-card-item">Немає нових запитів.</div>
            <% } %>
          </div>
        </div>
      </div>
      <div class="card shadow-sm">
        <div class="card-body">
          <h3 class="h5">Нові заявки волонтерів</h3>
          <div class="list-card">
            <% volunteers.forEach(function(volunteer) { %>
              <div class="list-card-item">
                <div>
                  <strong><%= volunteer.full_name %></strong>
                  <p class="mb-0 small text-muted"><%= volunteer.phone %> • <%= volunteer.region || 'Не вказано' %></p>
                </div>
                <span class="text-muted small"><%= new Date(volunteer.created_at).toLocaleString('uk-UA') %></span>
              </div>
            <% }) %>
            <% if (volunteers.length === 0) { %>
              <div class="list-card-item">Поки що заявок немає.</div>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<%- include('../partials/layout-end') %>
